
<div class="row g-3 mb-3 align-items-center">
    <!-- Búsqueda unificada -->
    <div class="col-md-2 pe-0">
        <div class="input-group">
            <input type="text" class="form-control" id="unifiedSearchFilter" placeholder="Buscar">
        </div>
    </div>

    <!-- Selector de Año -->
    <div class="col-auto ps-2">
        <div class="d-flex align-items-center">
            <label class="form-label mb-0 me-1 small">Año:</label>
            <ng-select
                style="width: 75px"
                [items]="anios"
                [(ngModel)]="selectedYear"
                [searchable]="false"
                [clearable]="false"
                (change)="onYearChange($event)">
            </ng-select>
        </div>
    </div>

    <!-- Selector de Mes -->
    <div class="col-auto ps-2">
        <div class="d-flex align-items-center">
            <label class="form-label mb-0 me-1 small">Mes:</label>
            <ng-select
                style="width: 75px"
                [items]="meses"
                [(ngModel)]="selectedMonth"
                [searchable]="false"
                [clearable]="false"
                (change)="onMonthChange($event)">
            </ng-select>
        </div>
    </div>

    <!-- Propietario con ng-select -->
    <div class="col-md-3 pe-0">
        <div class="d-flex align-items-center">
            <label class="form-label mb-0 me-1">Propietarios:</label>
            <ng-select
                class="w-100"
                [items]="propietariosOptions"
                [multiple]="true"
                [closeOnSelect]="false"
                [searchable]="true"
                bindLabel="label"
                bindValue="id"
                [clearable]="false"
                [(ngModel)]="filterValues.selectedPropietario"
                (change)="applyFilters()">
                <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                    <span>{{ items.length ? '(' + items.length + ') Seleccionados  ' : 'Seleccionar Propietario' }}</span>
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="propietario-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                    <span class="ms-2">{{item.label}}</span>
                </ng-template>
            </ng-select>
        </div>
    </div>

    <!-- Espacio flexible -->
    <div class="col">
    </div>



    <!-- Botones de acción -->
    <div class="col-auto ms-auto">
        <div class="d-flex gap-2">
            <button class="btn btn-primary action-btn" 
                    data-bs-target="#advancedFiltersModal"
                    data-bs-toggle="modal"
                    title="Filtros avanzados">
                    <i class="bi bi-funnel-fill"></i>
            </button>
            <button class="btn btn-secondary action-btn" (click)="clearFilters()" title="Limpiar filtros">
                <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-success action-btn" id="excelBtn" [disabled]="!exportButtonsEnabled" title="Exportar a Excel">
                <i class="bi bi-file-earmark-excel"></i>
            </button>
            <button class="btn btn-danger action-btn" id="pdfBtn" [disabled]="!exportButtonsEnabled" title="Exportar a PDF">
                <i class="bi bi-file-earmark-pdf"></i>
            </button>
        </div>
    </div>
</div>
<!-- Modal de Filtros Avanzados -->
<div class="modal fade" id="advancedFiltersModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Filtros Avanzados</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Tipo de <br> entrada</label>
                            <div class="input-group">
                                <ng-select
                                    class="flex-grow-1"
                                    [items]="entryExitOptions"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="value"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.entryOrExit"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="entry-modal-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Ingresante</label>
                            <div class="input-group">
                                <ng-select [items]="tiposIngresante"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="value"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.tipoIngresante"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="ingresante-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Vehículo</label>
                            <div class="input-group">
                                <ng-select [items]="tiposVehiculo"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="value"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.typeCar"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="vehiculo-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Estado</label>
                            <div class="input-group">
                                <ng-select [items]="estadoHorarioOptions"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="value"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.lateInRange"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="horario-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Días</label>
                            <div class="input-group">
                                <ng-select [items]="daysOptions"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="value"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.days"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="day-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group-with-label">
                            <label class="form-label modal-label">Guardia</label>
                            <div class="input-group">
                                <ng-select [items]="guardiasOptions"
                                    [multiple]="true"
                                    [closeOnSelect]="false"
                                    [searchable]="true"
                                    bindLabel="label"
                                    bindValue="id"
                                    [clearable]="false"
                                    [(ngModel)]="filterValues.selectedGuardia"
                                    (change)="applyFilters()">
                                    <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <span>({{items.length}}) Seleccionados </span>
                                    </ng-template>
                                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                        <input id="guardia-{{index}}" type="checkbox" [checked]="item$.selected"/> 
                                        <span class="ms-2">{{item.label}}</span>
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="applyFilters()">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Tabla -->
<div class="table-responsive">
    <table id="myTable" class="table table-striped">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Tipo</th>
                <th>Ingresante</th>
                <th>Nombre</th>
                <th>Documento</th>
                <th>Observaciones</th>
                <th>Vehículo</th>
                <th>Placa</th>
                <th>Propietario</th>
                <th>Guardia</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

